# 清主页 (Qing Home) / AuraTab 项目计划书（可执行版）

> 当前日期：2026-02-12
> 定位：自用、单用户、本机部署的极致轻量浏览器起始页（网站形态）
> 核心：书签数据从 WebDAV 拉取与回写（主格式 XBEL），配置类数据本地保存

---

## 1. 项目基本信息

- **项目名称**：清主页
- **英文名称**：AuraTab
- **项目形态**：网站（Web App），用户将其设置为浏览器首页/起始页
- **项目定位**：极致轻量、数据私有、离线可用、无中心化账号体系的个人主页/起始页
- **核心理念**：将数据还给用户。书签数据存储在用户自有 WebDAV 空间，不依赖第三方账号系统与中心化数据库。

---

## 2. 目标与边界（MVP 范围）

### 2.1 MVP 目标（必须实现）
- 主页展示书签（含分组/文件夹结构）
- 支持书签增删改（基于内部书签树模型）
- 支持从 WebDAV **拉取（Pull）** 远端书签文件并渲染
- 支持手动 **上传（Push）** 覆盖远端书签文件
- 本地离线可用：WebDAV 不可用时使用浏览器 LocalStorage 缓存数据
- WebDAV 远端书签文件主格式为 **XBEL**
- 支持 HTML 书签文件导入/导出（可选格式能力）

### 2.2 非目标（MVP 不做）
- 多用户体系、账号注册登录
- 安全加固（Token、加密存储、HTTPS 强制等）——先跑通基础结构
- 天气组件等外部 API 依赖
- 自动合并冲突（仅提示并按策略处理）

---

## 3. 总体架构

### 3.1 架构风格
- 前后端分离开发
- 生产部署为“单 Jar 包 + 内置静态资源”的轻量方案

### 3.2 数据分层（关键约定，定版）
本项目数据分为两类，必须严格分开：

1) **应用设置（App Settings，本地，仅后端保存，不同步）**
- 内容：WebDAV baseUrl、用户名、密码、远端书签文件路径、格式偏好等
- 存储：后端本机磁盘 `./data/settings.json`

2) **书签数据（Bookmarks Data，远端，仅 WebDAV 存储）**
- 主格式：**XBEL**
- 默认远端路径：`/qinghome/bookmarks.xbel`（用户可自定义）
- 可选：HTML 导入 / HTML 导出（不作为远端主存）

3) **离线缓存（前端 LocalStorage，仅缓存，不作为权威源）**
- 缓存：内部书签树模型 `BookmarksTree`
- 用途：WebDAV 不可用时仍可浏览/编辑

---

## 4. 技术栈选型

### 4.1 前端 (Frontend)
- Vue 3 (Vite)
- Tailwind CSS
- Pinia
- Axios

### 4.2 后端 (Backend)
- Java 17+ / Spring Boot 3
- Sardine（WebDAV 客户端）
- Jackson（JSON 序列化/反序列化）
- XBEL 解析与导出：建议使用 XML 解析（如 JAXP / DOM / SAX），MVP 优先稳定可控

---

## 5. 核心功能设计

## 5.1 内部书签模型（统一中间层）
无论远端为 XBEL 还是用户导入 HTML，最终都转换为同一份内部模型，供前端渲染与编辑。

### 5.1.1 BookmarksTree（建议结构）
- 节点类型仅两种：`folder` 与 `link`
- 必需字段最小集：
  - folder：`id`, `title`, `children`
  - link：`id`, `title`, `url`

示例：

```json
{
  "schemaVersion": 1,
  "updatedAt": "2026-02-12T00:00:00Z",
  "root": {
    "type": "folder",
    "id": "root",
    "title": "Bookmarks",
    "children": [
      {
        "type": "folder",
        "id": "f1",
        "title": "Work",
        "children": [
          {
            "type": "link",
            "id": "l1",
            "title": "GitHub",
            "url": "https://github.com/"
          }
        ]
      }
    ]
  }
}
```

> 备注：`id` 可由前端生成（如 UUID）。MVP 不引入 favicon/base64 等字段，避免体积膨胀。

---

## 5.2 WebDAV 同步逻辑（核心）

### 5.2.1 远端文件约定（定版）
- 远端主存：XBEL
- 默认路径：`/qinghome/bookmarks.xbel`
- 支持用户自定义 `remote.path`

### 5.2.2 Pull（从云端同步）
- 后端从 WebDAV 下载 XBEL 文件
- 解析为内部 `BookmarksTree`
- 返回给前端渲染
- 前端将 `BookmarksTree` 写入 LocalStorage 作为离线缓存

### 5.2.3 Push（上传到云端）
- 由用户手动触发
- 后端接收前端提交的 `BookmarksTree`
- 导出为 XBEL 文本
- 上传覆盖 WebDAV 远端文件

### 5.2.4 冲突与覆盖策略（定版）
- 默认策略：**远端覆盖本地（Prefer Remote）**
- 当检测到远端与本地不一致时弹窗提示：
  - 主按钮：使用远端覆盖本地（默认）
  - 次按钮：取消（保留本地，不覆盖）

> 冲突检测实现建议：记录远端指纹（优先 ETag 或 Last-Modified；否则用内容 hash）。
> MVP 不做自动合并。

---

## 5.3 离线缓存（LocalStorage）（定版）

### 5.3.1 缓存键建议
- `auratab.bookmarksTree`：内部书签树模型
- `auratab.remoteFingerprint`：远端指纹（etag/lastModified/hash）
- `auratab.lastPulledAt`：最近一次 Pull 时间

### 5.3.2 离线行为
- 启动时优先读取缓存并渲染
- 若 WebDAV Pull 成功，则以远端为准覆盖缓存
- 若 Pull 失败，则继续使用缓存并提示“离线模式/远端不可用”

---

## 5.4 WebDAV 服务提供商支持（新增）

### 5.4.1 坚果云（Jianguoyun）
- **基础 URL**：`https://dav.jianguoyun.com/dav/`
- **认证方式**：账户用户名和密码，推荐使用应用专用密码
- **注意事项**：坚果云有请求频率限制，后端已添加请求间隔以避免被限制
- **路径规范**：支持标准 WebDAV 路径结构

示例配置：
```json
{
  "schemaVersion": 1,
  "webdav": {
    "baseUrl": "https://dav.jianguoyun.com/dav/",
    "username": "your-email@example.com",
    "password": "your-app-password"
  },
  "remote": {
    "path": "/qinghome/bookmarks.xbel",
    "format": "xbel"
  },
  "sync": {
    "preferRemoteOnConflict": true
  }
}
```

> **重要提示**：为避免坚果云的请求频率限制，后端会在每次 WebDAV 操作之间添加适当的延迟。

### 5.4.2 通用 WebDAV 服务
- 支持任何符合 WebDAV 标准的服务提供商
- 需要提供有效的基础 URL、用户名和密码
- 支持自定义远程路径

---

## 5.5 HTML 导入/导出（可选能力，但建议纳入 MVP）
- HTML 导入：将浏览器导出书签 HTML（Netscape Bookmark 格式）解析为 `BookmarksTree`
- HTML 导出：将 `BookmarksTree` 导出为 HTML 文件供用户下载/导入浏览器
- 说明：HTML 不作为远端权威存储格式，仅作为兼容能力

---

## 6. 后端设置文件（本地 settings.json）

### 6.1 文件位置
- `./data/settings.json`

### 6.2 示例
```json
{
  "schemaVersion": 1,
  "webdav": {
    "baseUrl": "https://dav.example.com/dav/",
    "username": "yourname",
    "password": "yourpass"
  },
  "remote": {
    "path": "/qinghome/bookmarks.xbel",
    "format": "xbel"
  },
  "sync": {
    "preferRemoteOnConflict": true
  }
}
```

> 说明：MVP 阶段可先明文存储密码；后续可通过 `MASTER_KEY` 加密落盘或接入系统钥匙串。

---

## 7. 后端 API 契约（MVP 草案）

> 约定：JSON 响应统一结构建议为 `{ "ok": true, "data": ... }` 与 `{ "ok": false, "error": { "code": "...", "message": "..." } }`。
> MVP 不做鉴权，且后端默认仅监听 `127.0.0.1`。

### 7.1 Settings
- `GET /api/settings`
  - 作用：读取本地 `./data/settings.json`
- `PUT /api/settings`
  - 作用：保存本地 `./data/settings.json`

### 7.2 WebDAV 连通性测试
- `POST /api/webdav/test`
  - 作用：测试 settings 中的 WebDAV 是否可连接、目标路径是否可读写
  - 返回：读/写权限结果与错误原因，同时标识是否为坚果云服务

### 7.3 书签同步
- `GET /api/bookmarks/pull`
  - 作用：下载远端 XBEL → 解析为 `BookmarksTree` → 返回
  - 返回建议包含：`tree` + `remoteFingerprint`

- `POST /api/bookmarks/push`
  - 入参：`BookmarksTree`
  - 作用：导出为 XBEL → 上传覆盖远端文件
  - 返回：上传结果 + 新的 `remoteFingerprint`（若可获取）

---

## 8. “伪前后端分离”部署方案（单 Jar）

### 8.1 开发环境
- 前端：`localhost:5173`
- 后端：`localhost:8080`
- 通过 Vite proxy 解决跨域（/api 代理到 8080）

### 8.2 生产环境（单 Jar）
- 前端打包生成 `dist`
- 将 `dist` 放入 Spring Boot 的 `src/main/resources/static`
- 最终交付一个 `auratab.jar`（或 `qing-home.jar`）

---

## 9. 开发路线图（Roadmap，定版）

### Week 1：前端骨架 + 离线缓存
- [ ] Vue 3 + Tailwind + Pinia 初始化
- [ ] 主页 UI：书签分组/卡片展示
- [ ] 内部 BookmarksTree 的增删改（本地）
- [ ] LocalStorage 缓存：启动读取缓存，编辑后更新缓存
- [ ] 设置页 UI：WebDAV baseUrl/username/password、remotePath（自定义）、格式（默认 xbel）

### Week 2：后端骨架 + WebDAV + XBEL
- [ ] Spring Boot 3 初始化
- [ ] `./data/settings.json` 的读写接口（GET/PUT）
- [ ] Sardine WebDAV：下载/上传远端文件（remotePath 可配置）
- [ ] XBEL 解析（XBEL -> BookmarksTree）
- [ ] XBEL 导出（BookmarksTree -> XBEL）
- [ ] API：`/api/webdav/test`、`/api/bookmarks/pull`、`/api/bookmarks/push`

### Week 3：联调 + HTML 导入/导出 + 冲突提示
- [ ] 前后端联调：Pull 渲染、编辑、Push 覆盖远端
- [ ] HTML 导入：HTML -> BookmarksTree
- [ ] HTML 导出：BookmarksTree -> HTML 下载
- [ ] 冲突检测与弹窗（远端覆盖本地为默认）

---

## 10. 后续迭代（非 MVP）
- Docker 化：容器 + `./data` 卷挂载
- 安全加固：API Token、HTTPS、settings 加密存储（MASTER_KEY）
- 自动定时 Pull / 提醒用户 Push
- favicon 拉取与缓存（注意体积与隐私）
- 浏览器扩展形态（New Tab）支持

---
